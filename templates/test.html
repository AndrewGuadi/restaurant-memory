{% extends 'base.html' %}

{% block content %}
<h1>Test Yourself</h1>
<p>Choose the ingredients for {{ flashcard.beverage }} by dragging the items into the drop zone.</p>
<div id="ingredients-container" class="d-flex flex-wrap">
    {% for ingredient in all_ingredients %}
        <div id="ingredient{{ loop.index }}" class="ingredient-item" draggable="true">{{ ingredient }}</div>
    {% endfor %}
</div>
<div id="drop-zone" class="mt-4 p-3" style="border: 2px dashed #ccc; height: 200px; display: flex; align-items: center; justify-content: center;">
    Drop ingredients here
</div>

<form method="POST" action="{{ url_for('test') }}">
    <input type="hidden" name="flashcard_id" value="{{ flashcard.id }}">
    <input type="hidden" name="selected_ingredients" id="selected-ingredients">
    <button type="submit" class="btn btn-success mt-3">Submit</button>
</form>

{% if result %}
    <h2>Result</h2>
    <p>Selected Ingredients: {{ result.selected_ingredients }}</p>
    <p>Correct Ingredients: {{ result.correct_ingredients }}</p>
    <p>Correct: {{ result.is_correct }}</p>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function () {
    const ingredients = document.querySelectorAll('.ingredient-item');
    const dropZone = document.querySelector('#drop-zone');
    let selectedIngredients = [];

    ingredients.forEach(ingredient => {
        ingredient.addEventListener('dragstart', handleDragStart);
        ingredient.addEventListener('dragend', handleDragEnd);
    });

    dropZone.addEventListener('dragover', handleDragOver);
    dropZone.addEventListener('drop', handleDrop);

    function handleDragStart(e) {
        e.dataTransfer.setData('text/plain', e.target.id);
        e.target.classList.add('dragging');
    }

    function handleDragEnd(e) {
        e.target.classList.remove('dragging');
    }

    function handleDragOver(e) {
        e.preventDefault();
    }

    function handleDrop(e) {
        e.preventDefault();
        const id = e.dataTransfer.getData('text');
        const draggable = document.getElementById(id);
        dropZone.appendChild(draggable);
        selectedIngredients.push(draggable.textContent.trim());
        document.getElementById('selected-ingredients').value = selectedIngredients.join(',');
    }
});
</script>
{% endblock %}
